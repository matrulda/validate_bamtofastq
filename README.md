# validate_bamtofastq

This is a simple nextflow pipeline to validate the output of https://github.com/qbic-pipelines/bamtofastq.

The original fastqs (i.e the fastqs that was used to generate the bam file) are compared to the ones generated by bamtofastq.

The aim is to show that the generated fastqs are equivalent to the original fastqs.     


## Prerequisites
 - [Nextflow](https://www.nextflow.io/) is installed
 - This workflow will probably only work on a unix-like system

## Assumptions

This workflow assumes that the headers of the original fastqs have the following format:

> @EAS139:136:FC706VJ:2:2104:15343:197393 1:Y:18:ATCACG

## Procedure
The fastqs can not be compared as they are, due to:

 1. The headers of the generated fastqs have been slightly modified:

 > @EAS139:136:FC706VJ:2:2104:15343:197393/1

 That is:
  - Read pair information has been added to the first header section.
  - Information about filtering, control bits and index sequence has been removed.

2. The order of the reads are not the same in the fastqs.

To take these differences into account, the pipeline does the following:
 1. The headers of the original fastqs are modified to mimic the new format
 2. All fastqs are sorted based on the headers
 3. md5 checksums are calculated for all fastqs

The md5 checksums can then be inspected (this is a manual step) to validate the corresponding fastqs (i.e R1 vs R1) have the same checksums.

The md5 checksums file is written to `results/checksums.md5`

## How to run the pipeline

Assuming this repo has been cloned and is the CWD:

`nextflow run main.nf --original_fastqs /path/to/folder/* --generated_fastqs /path/to/folder/*`

 - `--original_fastqs`: Path to the original fastqs
 - `--generated_fastqs`: Path to the fastqs generated by bamtofastq 

Note that the provided `nextflow.config` is adapted for a HPC cluster with slurm. Update this config to fit the system you are on.

